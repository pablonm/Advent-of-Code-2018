const _ = require('lodash')
const { input, ops, processInput, processSamples } = require('./16-1.js')
const rawInstructions=['1 2 3 0','1 0 0 3','0 2 0 2','6 2 3 2','8 3 2 0','0 0 3 0','10 1 0 1','15 1 1 2','1 3 3 3','1 1 3 0','1 2 0 1','1 1 3 0','0 0 2 0','10 0 2 2','15 2 0 3','1 0 2 1','1 1 1 0','1 3 0 2','0 0 2 0','0 0 2 0','10 0 3 3','15 3 3 1','1 0 0 2','1 3 0 0','1 0 1 3','13 2 0 0','0 0 1 0','10 1 0 1','15 1 2 0','1 2 2 2','1 1 3 1','12 2 3 3','0 3 1 3','0 3 1 3','10 0 3 0','15 0 1 1','1 3 1 2','1 0 1 3','1 3 2 0','2 0 2 2','0 2 1 2','10 1 2 1','15 1 1 2','0 2 0 0','6 0 1 0','0 0 0 1','6 1 2 1','1 2 1 3','12 1 3 0','0 0 3 0','10 0 2 2','15 2 1 0','1 3 3 1','1 0 2 3','1 3 1 2','8 3 2 3','0 3 3 3','10 0 3 0','15 0 2 3','1 3 1 0','1 0 2 2','1 0 2 1','13 2 0 0','0 0 3 0','10 0 3 3','1 3 2 2','0 0 0 0','6 0 3 0','1 2 1 1','11 1 0 0','0 0 3 0','10 3 0 3','1 1 3 0','0 3 0 1','6 1 1 1','1 2 2 2','15 0 2 1','0 1 2 1','10 3 1 3','15 3 0 2','1 3 2 1','1 2 2 3','1 0 2 0','14 1 3 1','0 1 3 1','0 1 2 1','10 2 1 2','15 2 3 0','1 3 2 2','1 3 1 1','2 1 2 3','0 3 3 3','10 0 3 0','15 0 3 1','0 3 0 3','6 3 1 3','1 1 3 0','1 2 0 2','15 0 2 0','0 0 1 0','10 0 1 1','15 1 1 0','1 3 2 1','1 0 3 2','1 2 3 2','0 2 1 2','10 2 0 0','15 0 2 1','1 1 3 0','1 0 3 3','1 2 3 2','7 3 2 3','0 3 3 3','10 3 1 1','15 1 2 0','0 2 0 2','6 2 0 2','1 3 0 3','1 0 0 1','2 3 2 3','0 3 1 3','10 3 0 0','15 0 2 3','1 3 1 0','0 3 0 1','6 1 3 1','2 0 2 2','0 2 3 2','10 2 3 3','15 3 0 2','1 2 2 0','1 2 0 3','0 1 0 1','6 1 2 1','5 0 3 0','0 0 2 0','10 2 0 2','15 2 3 0','1 0 1 2','0 1 0 1','6 1 1 1','1 1 2 3','0 3 2 2','0 2 3 2','0 2 2 2','10 2 0 0','15 0 1 2','1 1 2 0','1 0 1 3','1 3 0 1','6 0 1 0','0 0 1 0','0 0 3 0','10 2 0 2','15 2 0 1','0 1 0 0','6 0 0 0','1 2 2 2','7 3 2 3','0 3 2 3','0 3 2 3','10 3 1 1','1 0 2 3','12 2 3 0','0 0 2 0','10 1 0 1','0 2 0 3','6 3 3 3','0 0 0 2','6 2 0 2','0 3 0 0','6 0 2 0','2 3 2 3','0 3 1 3','10 3 1 1','1 2 3 3','1 3 3 2','1 1 3 0','9 0 3 2','0 2 1 2','10 2 1 1','15 1 1 3','1 3 3 2','1 0 0 1','6 0 1 1','0 1 3 1','10 1 3 3','15 3 2 2','1 3 2 3','1 1 0 1','10 0 0 1','0 1 1 1','10 2 1 2','15 2 1 1','1 0 2 2','1 3 1 0','0 0 0 3','6 3 2 3','8 2 3 3','0 3 2 3','10 3 1 1','15 1 0 2','1 2 0 0','1 1 1 3','0 2 0 1','6 1 3 1','4 0 3 1','0 1 2 1','0 1 2 1','10 2 1 2','1 3 1 1','1 2 3 3','3 0 1 0','0 0 2 0','10 2 0 2','15 2 3 1','1 0 3 2','1 3 3 0','8 2 3 0','0 0 2 0','0 0 2 0','10 0 1 1','15 1 3 0','1 2 2 2','1 3 2 1','1 0 2 3','7 3 2 1','0 1 2 1','10 0 1 0','15 0 0 3','0 0 0 2','6 2 0 2','1 3 1 1','1 1 1 0','6 0 1 0','0 0 3 0','0 0 2 0','10 3 0 3','15 3 3 1','1 1 2 0','0 2 0 2','6 2 2 2','1 0 1 3','7 3 2 2','0 2 1 2','10 2 1 1','15 1 1 2','0 1 0 0','6 0 2 0','1 2 2 1','1 1 1 3','4 0 3 1','0 1 2 1','10 1 2 2','0 1 0 3','6 3 2 3','0 1 0 1','6 1 1 1','1 1 1 0','10 1 0 1','0 1 2 1','10 1 2 2','15 2 3 3','0 3 0 1','6 1 3 1','0 1 0 2','6 2 0 2','6 0 1 1','0 1 3 1','10 3 1 3','15 3 1 0','1 2 0 3','0 2 0 1','6 1 3 1','8 2 3 3','0 3 3 3','10 0 3 0','1 1 1 3','1 0 0 1','0 3 2 3','0 3 1 3','10 3 0 0','15 0 3 1','1 1 3 3','1 3 1 0','0 2 0 2','6 2 2 2','11 2 0 0','0 0 1 0','10 1 0 1','15 1 3 0','1 0 0 3','0 2 0 2','6 2 3 2','1 1 3 1','0 1 2 3','0 3 1 3','0 3 3 3','10 0 3 0','15 0 1 2','1 1 3 0','0 2 0 1','6 1 0 1','1 1 0 3','6 0 1 1','0 1 3 1','10 2 1 2','15 2 3 0','1 3 2 1','1 0 2 2','6 3 1 2','0 2 3 2','10 2 0 0','1 0 3 1','1 0 3 3','0 3 0 2','6 2 2 2','7 3 2 1','0 1 3 1','10 0 1 0','15 0 2 1','1 1 3 3','0 3 0 0','6 0 3 0','0 2 0 2','6 2 0 2','1 2 3 3','0 3 1 3','10 1 3 1','15 1 1 2','1 2 3 3','1 2 3 1','14 0 1 0','0 0 1 0','10 2 0 2','15 2 0 0','0 0 0 3','6 3 0 3','1 2 0 2','1 0 2 1','7 3 2 2','0 2 1 2','0 2 3 2','10 0 2 0','15 0 3 3','1 2 2 2','1 2 2 1','0 1 0 0','6 0 3 0','11 1 0 1','0 1 3 1','10 1 3 3','15 3 3 1','1 2 1 0','0 0 0 3','6 3 1 3','1 0 0 2','4 0 3 3','0 3 1 3','10 3 1 1','15 1 1 3','1 1 3 0','1 1 1 1','10 1 0 2','0 2 3 2','10 2 3 3','15 3 1 1','1 2 1 3','1 2 2 2','12 2 3 3','0 3 3 3','10 1 3 1','15 1 3 2','1 2 1 1','1 2 2 3','1 3 2 0','14 0 3 1','0 1 1 1','10 1 2 2','1 2 0 1','11 1 0 1','0 1 3 1','0 1 2 1','10 1 2 2','1 2 2 1','14 0 1 1','0 1 2 1','0 1 2 1','10 1 2 2','15 2 0 0','1 0 2 2','1 3 3 1','0 0 0 3','6 3 3 3','2 3 2 1','0 1 1 1','10 0 1 0','15 0 1 1','1 0 2 3','0 1 0 2','6 2 3 2','1 1 3 0','8 3 2 3','0 3 2 3','0 3 3 3','10 3 1 1','15 1 3 2','1 2 3 3','1 2 3 1','0 0 0 0','6 0 2 0','5 0 3 3','0 3 1 3','10 2 3 2','15 2 0 3','1 1 0 0','0 3 0 2','6 2 0 2','0 0 2 0','0 0 2 0','10 0 3 3','15 3 3 1','0 1 0 0','6 0 3 0','1 2 1 3','1 1 3 2','2 0 2 3','0 3 1 3','0 3 2 3','10 1 3 1','1 1 1 0','1 2 3 3','1 2 3 2','15 0 2 3','0 3 1 3','10 1 3 1','1 3 3 0','1 1 2 3','3 2 0 3','0 3 1 3','0 3 2 3','10 1 3 1','15 1 2 0','1 3 2 2','1 1 0 3','1 3 3 1','2 1 2 3','0 3 3 3','0 3 3 3','10 3 0 0','1 0 0 3','0 1 0 1','6 1 2 1','1 2 3 2','7 3 2 1','0 1 2 1','10 0 1 0','15 0 3 2','1 2 0 0','1 2 0 3','1 3 2 1','5 0 3 1','0 1 3 1','0 1 1 1','10 1 2 2','15 2 3 1','1 3 0 3','1 1 2 0','0 1 0 2','6 2 0 2','2 3 2 3','0 3 3 3','10 1 3 1','15 1 1 2','1 3 0 1','1 2 1 3','1 0 2 0','14 1 3 3','0 3 3 3','0 3 3 3','10 3 2 2','15 2 1 1','1 0 2 2','1 2 3 0','0 0 0 3','6 3 1 3','0 3 2 0','0 0 3 0','10 1 0 1','15 1 0 3','1 2 2 2','1 1 3 0','1 3 0 1','10 0 0 0','0 0 3 0','10 3 0 3','15 3 0 0','0 3 0 2','6 2 0 2','1 1 1 3','6 3 1 3','0 3 1 3','0 3 3 3','10 0 3 0','15 0 1 1','0 0 0 2','6 2 2 2','1 1 2 3','1 2 0 0','4 0 3 3','0 3 1 3','0 3 2 3','10 1 3 1','1 0 1 0','1 0 0 2','1 2 3 3','8 2 3 3','0 3 2 3','10 1 3 1','1 3 3 0','1 2 1 3','14 0 3 2','0 2 3 2','10 1 2 1','15 1 0 2','1 2 0 0','1 3 1 1','3 0 1 3','0 3 3 3','10 2 3 2','15 2 2 3','1 3 0 2','14 1 0 2','0 2 3 2','10 3 2 3','15 3 3 1','1 0 2 0','1 0 2 2','0 1 0 3','6 3 2 3','1 2 0 0','0 0 1 0','0 0 1 0','10 1 0 1','15 1 3 3','1 3 3 1','1 2 3 0','1 1 1 2','14 1 0 1','0 1 3 1','10 1 3 3','15 3 0 2','1 0 2 1','1 2 1 3','5 0 3 1','0 1 1 1','10 2 1 2','15 2 3 1','1 0 1 3','1 1 0 0','1 2 1 2','7 3 2 0','0 0 3 0','0 0 2 0','10 1 0 1','0 2 0 0','6 0 3 0','1 1 2 3','1 3 3 2','0 3 2 0','0 0 2 0','10 0 1 1','15 1 0 0','1 0 3 2','0 1 0 1','6 1 0 1','6 3 1 1','0 1 1 1','10 1 0 0','15 0 1 3','1 1 0 0','1 0 2 1','6 0 1 1','0 1 2 1','0 1 3 1','10 3 1 3','15 3 1 0','1 0 1 1','1 2 3 3','8 2 3 3','0 3 1 3','0 3 1 3','10 3 0 0','15 0 0 1','1 1 1 3','0 0 0 0','6 0 2 0','1 2 0 2','9 3 0 3','0 3 3 3','0 3 1 3','10 1 3 1','1 3 3 2','1 2 2 3','13 0 2 2','0 2 1 2','10 2 1 1','15 1 0 0','1 0 0 3','1 1 3 1','1 2 2 2','7 3 2 3','0 3 2 3','0 3 3 3','10 3 0 0','15 0 2 1','1 1 2 0','1 3 2 2','1 2 0 3','9 0 3 3','0 3 3 3','10 3 1 1','1 1 0 3','1 2 2 0','9 3 0 2','0 2 3 2','10 1 2 1','1 0 0 2','9 3 0 0','0 0 3 0','10 1 0 1','15 1 3 2','1 2 0 1','1 2 2 0','9 3 0 0','0 0 2 0','10 2 0 2','1 2 2 3','1 2 1 0','12 1 3 3','0 3 1 3','10 3 2 2','1 1 0 0','0 1 0 3','6 3 2 3','9 0 3 1','0 1 1 1','10 1 2 2','15 2 2 0','0 2 0 2','6 2 3 2','1 3 0 1','14 1 3 2','0 2 2 2','10 0 2 0','15 0 1 2','1 2 1 0','0 1 0 1','6 1 1 1','1 1 0 3','4 0 3 3','0 3 2 3','10 2 3 2','15 2 0 0','0 3 0 3','6 3 0 3','1 2 3 2','7 3 2 1','0 1 3 1','10 1 0 0','15 0 2 1','1 2 0 0','0 2 0 3','6 3 3 3','1 3 2 2','13 0 2 0','0 0 2 0','0 0 1 0','10 1 0 1','1 2 3 2','1 0 3 3','1 0 1 0','12 2 3 2','0 2 2 2','10 1 2 1','15 1 1 2','1 0 0 1','1 2 1 3','1 2 3 0','5 0 3 3','0 3 2 3','10 3 2 2','15 2 1 3','1 3 1 0','1 2 3 2','3 2 0 1','0 1 2 1','10 1 3 3','15 3 1 1','0 1 0 0','6 0 2 0','0 3 0 3','6 3 1 3','4 0 3 2','0 2 1 2','10 2 1 1','15 1 0 3','1 1 0 0','1 0 0 1','1 1 2 2','6 0 1 1','0 1 3 1','10 1 3 3','15 3 0 0','0 1 0 1','6 1 2 1','1 3 1 3','1 0 0 2','14 3 1 2','0 2 1 2','10 0 2 0','15 0 3 3','0 3 0 2','6 2 1 2','1 3 0 0','0 1 0 1','6 1 3 1','2 0 2 1','0 1 2 1','10 1 3 3','15 3 3 1','1 2 0 0','1 2 2 2','1 1 2 3','4 0 3 0','0 0 2 0','10 0 1 1','15 1 1 3','1 3 0 1','1 1 2 0','1 0 2 2','0 0 2 1','0 1 2 1','10 3 1 3','1 2 0 1','1 2 3 2','15 0 2 0','0 0 1 0','10 0 3 3','15 3 1 0','1 3 1 1','0 1 0 3','6 3 1 3','6 3 1 3','0 3 3 3','10 0 3 0','15 0 3 1','1 0 0 3','1 3 0 0','11 2 0 2','0 2 1 2','10 1 2 1','1 0 1 2','1 0 0 0','1 3 0 2','0 2 3 2','10 2 1 1','1 1 2 0','1 0 3 2','1 1 3 3','0 3 2 3','0 3 2 3','10 1 3 1','15 1 0 3','1 2 3 2','1 3 0 0','1 3 0 1','3 2 1 0','0 0 3 0','10 0 3 3','15 3 1 2','1 2 1 1','1 0 1 3','0 1 0 0','6 0 3 0','14 0 1 3','0 3 1 3','0 3 2 3','10 2 3 2','15 2 0 1','0 2 0 3','6 3 0 3','1 3 0 2','1 2 1 0','12 0 3 3','0 3 3 3','10 3 1 1','15 1 3 0','0 3 0 3','6 3 0 3','1 1 3 1','0 1 2 2','0 2 1 2','10 0 2 0','15 0 2 2','1 2 0 3','1 2 2 0','5 0 3 1','0 1 3 1','10 1 2 2','15 2 2 1','1 3 2 2','1 3 1 3','2 3 2 0','0 0 1 0','0 0 1 0','10 0 1 1','0 1 0 2','6 2 2 2','1 2 0 3','1 2 0 0','12 2 3 2','0 2 2 2','0 2 1 2','10 2 1 1','15 1 3 3','1 1 1 0','1 3 2 2','1 2 1 1','11 1 2 0','0 0 3 0','10 0 3 3','15 3 2 1','1 2 2 0','1 3 2 3','2 3 2 2','0 2 3 2','0 2 2 2','10 2 1 1','1 0 1 2','1 1 2 3','4 0 3 2','0 2 2 2','10 2 1 1','15 1 3 0','0 2 0 2','6 2 2 2','1 0 2 3','1 0 0 1','7 3 2 3','0 3 1 3','10 3 0 0','1 2 1 3','1 2 3 1','1 1 0 2','12 1 3 2','0 2 1 2','0 2 2 2','10 0 2 0','1 0 0 2','8 2 3 1','0 1 2 1','10 1 0 0','15 0 1 3','1 2 3 2','0 0 0 0','6 0 1 0','1 3 0 1','15 0 2 1','0 1 2 1','10 3 1 3','15 3 2 1','1 2 1 0','1 1 0 2','0 2 0 3','6 3 2 3','5 0 3 2','0 2 2 2','10 2 1 1','15 1 1 0','1 1 2 3','0 0 0 1','6 1 0 1','0 1 0 2','6 2 1 2','10 3 3 2','0 2 1 2','10 0 2 0','15 0 2 2','1 2 3 0','1 2 1 1','1 2 0 3','12 1 3 0','0 0 2 0','10 2 0 2','0 1 0 1','6 1 3 1','1 1 1 3','1 0 0 0','6 3 1 3','0 3 2 3','10 2 3 2','15 2 1 0','1 3 1 2','1 0 1 3','8 3 2 2','0 2 2 2','10 0 2 0','15 0 1 2','1 1 2 1','1 1 0 0','1 1 0 3','10 0 0 0','0 0 2 0','0 0 3 0','10 0 2 2','15 2 0 0','0 0 0 2','6 2 2 2','0 3 0 1','6 1 2 1','10 3 3 3','0 3 1 3','0 3 1 3','10 3 0 0','15 0 0 1','1 3 0 0','1 3 2 3','3 2 0 2','0 2 3 2','10 2 1 1','15 1 1 3','1 1 3 1','1 3 1 2','0 1 2 1','0 1 2 1','10 3 1 3','15 3 2 0',]

let samples = processInput(input)
let { possibleOpCodes } = processSamples(samples)
let opCodes = Array(16).fill(null)
while (opCodes.filter(o => o === null).length > 0) {
    let known = _.minBy(possibleOpCodes.filter(p => p !== null && p.length > 0), p => p.length)[0]
    for (let i = 0; i < possibleOpCodes.length; i++)Â {
        if (possibleOpCodes[i] !== null) {
            possibleOpCodes[i] = possibleOpCodes[i].filter(o => o !== known)
            if (possibleOpCodes[i].length === 0) {
                possibleOpCodes[i] = null
                opCodes[i] = ops[known]
            }
        }
    }
}

let register = [0,0,0,0]
let instructions = rawInstructions.map(i => i.split(' ').map(n => parseInt(n)))
for (let i = 0; i < instructions.length; i++)
    register = opCodes[instructions[i][0]](register, instructions[i])
    
console.log('16-2 solution: ' + register[0])
